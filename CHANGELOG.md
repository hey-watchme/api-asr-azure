# 変更履歴

このファイルには、Azure Speech Services API (vibe-transcriber-v2) のすべての重要な変更が記録されています。

## [1.49.0] - 2025-09-23

### 追加
- **処理制限モード機能**: 特定デバイスの時間帯別処理制限
  - デバイスID `9f7d6e27-98c3-4c19-bdfb-f7fda58b9a93` の23:00-05:59の処理をスキップ
  - ステータスを`skipped`に設定して処理スキップを明示
  - コスト最適化のための運用制限機能として実装

### 改善
- **Quota exceededエラーの検出改善**: 
  - エラーメッセージから直接"quota exceeded"を検出
  - 例外処理時でも適切に`quota_exceeded`ステータスを設定

## [1.48.0] - 2025-09-23

### 追加
- **エラーステータス管理機能**: Azure利用上限エラーを適切に処理
  - 新しいステータス値: `failed`（エラー発生）、`quota_exceeded`（Azure利用上限超過）
  - エラー発生時に自動的にステータスを更新し、`pending`のまま残らないように改善
- **Azure利用上限検知ロジック**: 
  - 日本時間0:00-9:00の間で結果が空の場合、利用上限の可能性を検知
  - `quota_exceeded`ステータスを設定して明確に区別
- **タイムスタンプ記録機能**:
  - `vibe_whisper`テーブルに`created_at`カラムを追加
  - 処理実行時刻をUTC形式で自動記録

### 依存関係
- pytz==2024.1（タイムゾーン処理用）を追加

## [1.47.1] - 2025-08-29

### 修正
- **重要なバグ修正**: 空の音声認識結果の状態区別問題を解決

### 改善
- **データ保存改善**: 「未処理」と「処理済み・発話なし」を明確に区別
  - 発話なしの場合は「発話なし」としてデータベースに保存
  - ログ出力で発話有無を明示表示

### ドキュメント
- **開発フロー文書化**: 本番環境での直接修正を防ぐためのガイドライン追加
- **Dockerfileの追加**: 正しいECRベースのデプロイフローを確立

## [1.47.0] - 2025-08-29

### 追加
- **Docker/ECR設定の整理**: 本番デプロイ用の設定ファイルを追加
- **watchme-network対応**: docker-compose.prod.ymlを`external: true`設定に
- **運用の明確化**: ECRベースのデプロイ構成を文書化

## [1.46.0] - 2025-08-26

### 追加
- **WatchMeシステム統合機能**: Supabase + AWS S3との完全統合
- **新エンドポイント**: `/fetch-and-transcribe` でデバイスIDと日付による効率的なバッチ処理
- **後方互換性保持**: 既存のfile_pathsインターフェースも継続サポート

### 依存関係
- boto3とsupabase Python SDKを追加

## [1.45.0] - 2025-08-26

### アップグレード
- **Azure Speech SDK を最新版に**: 1.34.0 → 1.45.0
- **音声認識の問題を解決**: SDK更新により認識精度が大幅に向上
- **本番環境で動作確認済み**: vibe-transcriber-v2として稼働中

## 過去のバージョン

### 2025年以前の主要な変更
- 初期実装: Azure Speech Servicesを使用した基本的な音声認識機能
- FastAPIフレームワークの採用
- Dockerコンテナ化
- EC2/ECRへのデプロイ構成
- WatchMeプラットフォームとの統合

---

フォーマット仕様は [Keep a Changelog](https://keepachangelog.com/ja/1.0.0/) に準拠しています。